# PowerShell启动脚本使用说明

## 脚本介绍

`steel_system.ps1` 是钢材采购损耗率估算系统的一键启动脚本，使用PowerShell编写，能够自动启动前端和后端服务。

## 功能特点

- ✅ **环境检查**：自动检查Node.js和npm环境
- ✅ **依赖管理**：自动检查并安装项目依赖
- ✅ **双服务启动**：同时启动前端和后端服务
- ✅ **日志记录**：自动记录服务运行日志
- ✅ **浏览器自动打开**：启动完成后自动打开系统界面
- ✅ **进程管理**：支持优雅停止所有服务

## 使用方法

### 1. 基本使用

在项目根目录打开PowerShell，运行以下命令：

```powershell
powershell -ExecutionPolicy Bypass -File steel_system.ps1
```

### 2. 如果遇到执行策略问题

如果出现"无法加载文件，因为在此系统上禁止运行脚本"的错误，请以管理员身份运行PowerShell并执行：

```powershell
# 临时允许执行脚本（推荐）
Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope Process

# 或者永久设置（需要管理员权限）
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned
```

然后再运行启动脚本。

### 3. 右键菜单快速启动

1. 右键点击 `steel_system.ps1` 文件
2. 选择"使用PowerShell运行"

## 启动流程

脚本会按以下顺序执行：

1. **环境检查**
   - 检查是否在项目根目录
   - 验证Node.js和npm是否已安装

2. **依赖安装**
   - 检查根目录依赖包
   - 检查前端依赖包
   - 如果缺少依赖，自动运行`npm install`

3. **服务启动**
   - 启动后端服务器（端口5001）
   - 启动前端开发服务器（端口3000）
   - 验证服务是否启动成功

4. **浏览器打开**
   - 等待前端服务器完全启动
   - 自动在默认浏览器中打开系统界面

## 服务地址

启动成功后，系统将在以下地址提供服务：

- **前端界面**：http://localhost:3000
- **后端API**：http://localhost:5001

## 日志文件

脚本会自动创建日志目录并记录服务运行日志：

- **日志目录**：`./logs/`
- **后端日志**：`server_YYYY-MM-DD_HH-mm-ss.log`
- **前端日志**：`client_YYYY-MM-DD_HH-mm-ss.log`

## 停止系统

有几种方式可以停止系统：

1. **在启动脚本窗口中按任意键**（推荐）
2. **关闭所有PowerShell窗口**
3. **按Ctrl+C终止进程**

## 故障排除

### 常见问题

1. **端口被占用**
   ```
   Error: listen EADDRINUSE :::3000
   ```
   解决方法：
   - 关闭占用端口的其他应用
   - 或使用以下命令查找并终止进程：
   ```powershell
   netstat -ano | findstr :3000
   taskkill /PID <进程ID> /F
   ```

2. **Node.js未安装**
   ```
   Node.js未安装或未添加到PATH
   ```
   解决方法：
   - 从 https://nodejs.org/ 下载并安装Node.js
   - 安装后重启PowerShell

3. **依赖安装失败**
   ```
   npm install失败
   ```
   解决方法：
   - 检查网络连接
   - 尝试清除npm缓存：`npm cache clean --force`
   - 删除node_modules文件夹后重新运行脚本

4. **浏览器未自动打开**
   - 手动访问 http://localhost:3000
   - 检查防火墙设置

### 手动启动方式

如果脚本启动失败，可以手动启动服务：

1. **启动后端**：
   ```powershell
   node server/index.js
   ```

2. **启动前端**（新的PowerShell窗口）：
   ```powershell
   cd client
   npm start
   ```

## 系统要求

- **操作系统**：Windows 10/11 with PowerShell 5.1+
- **Node.js**：版本14.0或更高
- **npm**：版本6.0或更高
- **内存**：建议4GB以上
- **端口**：确保3000和5001端口未被占用

## 注意事项

1. **首次运行**可能需要较长时间来下载依赖包
2. **前端启动**通常需要30-60秒，请耐心等待
3. **生产环境部署**时建议使用专门的部署脚本
4. **防火墙**可能会询问是否允许Node.js访问网络，请选择允许

## 技术支持

如果遇到问题，请检查：

1. **日志文件**：查看详细错误信息
2. **系统要求**：确保满足最低配置要求
3. **网络连接**：确保能正常访问npm仓库
4. **权限设置**：确保有足够的文件读写权限

---

**注意**：此脚本仅用于开发环境，生产环境部署请使用专门的部署方案。 